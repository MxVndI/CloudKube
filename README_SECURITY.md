# Безопасность и аутентификация в CloudKube

## Описание

Приложение CloudKube использует JWT-токены для аутентификации. Все эндпоинты требуют авторизации, кроме указанных ниже.

## Публичные эндпоинты (без авторизации)

- `/login` - вход в систему
- `/register` - регистрация нового пользователя
- `/static/**` - статические ресурсы
- `/css/**` - CSS файлы
- `/images/**` - изображения (включая загруженные в MinIO)
- `/js/**` - JavaScript файлы
- `/templates/**` - HTML шаблоны

## Защищенные эндпоинты (требуют авторизации)

- `/users/**` - все операции с пользователями
- `/posts/**` - все операции с постами
- `/chat/**` - чат функциональность
- Все остальные эндпоинты

## Как работает аутентификация

1. **Регистрация**: POST `/register` с данными пользователя
2. **Вход**: POST `/login` с логином и паролем
3. **Получение JWT**: После успешного входа возвращается JWT токен
4. **Использование токена**: Добавлять в заголовок `Authorization: Bearer <token>`

## Пример использования

### Регистрация
```bash
curl -X POST http://localhost:8080/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"password123"}'
```

### Вход
```bash
curl -X POST http://localhost:8080/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"password123"}'
```

### Использование защищенного эндпоинта
```bash
curl -X GET http://localhost:8080/users/1 \
  -H "Authorization: Bearer <your-jwt-token>"
```

## Конфигурация безопасности

- **JWT**: Используется для stateless аутентификации
- **BCrypt**: Для хеширования паролей
- **CSRF**: Отключен для API
- **Sessions**: Отключены (stateless)

## Troubleshooting

### Ошибка "principal is null"
Эта ошибка возникает, когда:
1. JWT токен отсутствует в заголовке Authorization
2. JWT токен недействителен или истек
3. Пользователь не аутентифицирован

### Решение
Убедитесь, что:
1. Отправляете правильный заголовок `Authorization: Bearer <token>`
2. JWT токен действителен и не истек
3. Пользователь существует в системе
